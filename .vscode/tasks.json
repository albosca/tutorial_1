{
	"version": "2.0.0",
	"tasks": [
		{
			"label": "Run CMake (stm32f446re, debug)",
			"options": {
				"cwd": "${workspaceRoot}"
			},
			"group": {
				"kind": "build",
				"isDefault": true
			},
			"command": "cmake",
			"args": [
				"-Bbuild/stm32f446re/Debug",
				"-DPLATFORM=stm32f446re",
				"-DCMAKE_BUILD_TYPE=Debug",
			],
			"windows": {
				"args": [
					"-G", "MinGW Makefiles",
					"-Bbuild/stm32f446re/Debug",
					"-DPLATFORM=stm32f446re",
					"-DCMAKE_BUILD_TYPE=Debug",
				]
			}
		},
		{
			"label": "Build (stm32f446re, debug)",
			"dependsOn": [
				"Run CMake (stm32f446re, debug)"
			],
			"options": {
				"cwd": "${workspaceRoot}"
			},
			"group": {
				"kind": "build"
			},
			"command": "make",
			"windows": {
				"command": "mingw32-make"
			},
			"args": [
				"-Cbuild/stm32f446re/Debug",
				"${input:cortexTargetID}",
			]
		},
		{
			"label": "Flash (stm32f446re, debug)",
			"dependsOn": [
				"Build (stm32f446re, debug)"
			],
			"options": {
				"cwd": "${workspaceRoot}"
			},
			"group": {
				"kind": "build"
			},
			"command": "make",
			"windows": {
				"command": "mingw32-make"
			},
			"args": [
				"-Cbuild/stm32f446re/Debug",
				"flash-${input:cortexTargetID}",
			]
		},
		{
			"label": "Clean (stm32f446re, debug)",
			"options": {
				"cwd": "${workspaceRoot}"
			},
			"group": {
				"kind": "build"
			},
			"command": "make",
			"windows": {
				"command": "mingw32-make"
			},
			"args": [
				"-Cbuild/stm32f446re/Debug",
				"clean",
			]
		},
		{
			"label": "Clean and flash (stm32f446re, debug)",
			"dependsOn": [
				"Clean (stm32f446re, debug)",
				"Flash (stm32f446re, debug)"
			],
			"group": {
				"kind": "build"
			},
			"options": {
				"cwd": "${workspaceRoot}"
			},
		},
		{
			"label": "Run CMake (advanced)",
			"options": {
				"cwd": "${workspaceRoot}"
			},
			"group": {
				"kind": "build",
				"isDefault": true
			},
			"command": "cmake",
			"args": [
				"-Bbuild/${input:platformID}/${input:buildType}",
				"-DPLATFORM=${input:platformID}",
				"-DCMAKE_BUILD_TYPE=${input:buildType}",
			],
			"windows": {
				"args": [
					"-G", "MinGW Makefiles",
					"-Bbuild/${input:platformID}/${input:buildType}",
					"-DPLATFORM=${input:platformID}",
					"-DCMAKE_BUILD_TYPE=${input:buildType}",
				]
			}
		},
		{
			"label": "Build (advanced)",
			"dependsOn": [
				"Run CMake (advanced)"
			],
			"options": {
				"cwd": "${workspaceRoot}"
			},
			"group": {
				"kind": "build"
			},
			"command": "make",
			"windows": {
				"command": "mingw32-make"
			},
			"args": [
				"-Cbuild/${input:platformID}/${input:buildType}",
				"${input:targetID}",
			]
		},
		{
			"label": "Flash (advanced)",
			"dependsOn": [
				"Build (advanced)"
			],
			"options": {
				"cwd": "${workspaceRoot}"
			},
			"group": {
				"kind": "build"
			},
			"command": "make",
			"windows": {
				"command": "mingw32-make"
			},
			"args": [
				"-Cbuild/${input:platformID}/${input:buildType}",
				"flash-${input:targetID}",
			]
		},
		{
			"label": "Run tests (advanced)",
			"dependsOn": [
				"Build (advanced)"
			],
			"options": {
				"cwd": "${workspaceRoot}",
				"${input:platformID}": "native"
			},
			"group": {
				"kind": "test"
			},
			"command": "ctest",
			"args": [
				"--test-dir",
				"build/${input:platformID}/${input:buildType}",
				"--output-on-failure",
			]
		}
	],
	"inputs": [
		{
			"id": "platformID",
			"type": "pickString",
			"description": "Enter the platform:",
			"default": "native",
			"options": [
				"native",
				"stm32f446re"
			]
		},
		{
			"id": "targetID",
			"type": "promptString",
			"description": "Enter the target:",
			"default": "main"
		},
		{
			"id": "buildType",
			"type": "pickString",
			"description": "Enter the build type:",
			"default": "Debug",
			"options": [
				"Debug",
				"Release"
			]
		},
		{
			"id": "cortexTargetID",
			"type": "command",
			"command": "extension.commandvariable.rememberPick",
      		"args": { "key": "lasttarget" }
		},
	]
}
